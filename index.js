import { Telegraf } from "telegraf";
import express from "express";
import { CronJob } from "cron";
import dotenv from "dotenv";
import mongoose from "mongoose";

import { messages } from "./messages.js";
import { excuses } from "./excuses.js";
import { images } from "./images.js";
import { stopMsgs } from "./stop.js";

import { User } from "./models/User.js";
import { CronTask } from "./models/CronTask.js";

dotenv.config();

async function restoreCronJobs() {
    const activeTasks = await CronTask.find({});
    activeTasks.forEach((task) => {
        startCronJob(task.chatId);
    });
}

async function updateCronJobs() {
    const activeTasks = await CronTask.find({});
    activeTasks.forEach(async (task) => {

        if (task) {

            if (task.job) {
                task.job.stop();
            }

            const newJob = new CronJob(
                "43 5 * * *",
                async function () {
                    /* const currentMessage = messages[task.messageIndex]; */
                    const currentMessage = "ðŸŒž Ð”Ð¾Ð±Ñ€Ð¾Ðµ Ð¸ Ñ‡ÑƒÐ´ÐµÑÐ½Ð¾Ðµ ÑƒÑ‚Ñ€ÐµÑ‡ÐºÐ¾! Ð’ÑÑ‚Ð°Ð²Ð°Ð¹, Ð¿Ñ€Ð¸Ð½Ñ†ÐµÑÑÐ°ðŸ‘¸, ÑÐµÐ³Ð¾Ð´Ð½Ñ Ñ‚Ð²Ð¾Ð¹ Ð´ÐµÐ½ÑŒ, Ð´ÐµÐ½ÑŒ ÑÐ°Ð¼Ð¾Ð¹ Ð¿Ñ€ÐµÐºÑ€Ð°ÑÐ½Ð¾Ð¹ Ð±Ð°Ð±Ð°Ñ‡ÐµÐ½ÐºÐ¸ Ð½Ð° Ð·ÐµÐ¼Ð»Ðµ! Ð¡ Ð¿Ñ€Ð°Ð·Ð´Ð½Ð¸Ñ‡ÐºÐ¾Ð¼ Ñ‚ÐµÐ±Ñ! ÐŸÐ¾Ð»ÑŒÐ·ÑƒÑÑÑŒ ÑÐ»ÑƒÑ‡Ð°ÐµÐ¼ Ñ‚Ð¾Ñ€Ð¶ÐµÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ð³Ð¾ Ð´Ð½Ñ, Ñ Ñ…Ð¾Ñ‚ÐµÐ» Ð±Ñ‹ Ñ€Ð°ÑÑÐºÐ°Ð·Ð°Ñ‚ÑŒ Ñ‚ÐµÐ±Ðµ Ð¸ÑÑ‚Ð¾Ñ€Ð¸ÑŽ Ð¾ Ñ‚Ð¾Ð¼, Ñ‡Ñ‚Ð¾ ÑÐ¿Ð¾Ð´Ð²Ð¸Ð³Ð»Ð¾ Ð¼ÐµÐ½Ñ Ð½Ð°Ð¹Ñ‚Ð¸ Ñ‚ÐµÐ±Ñâ€¦ ðŸŒ³âœ¨ ÐžÐ´Ð½Ð°Ð¶Ð´Ñ‹, Ð² Ð¾Ð´Ð½Ð¾Ð¼ Ñ‡ÑƒÐ´ÐµÑÐ½Ð¾Ð¼ Ð»ÐµÑÑƒ, Ð³Ð´Ðµ Ð´ÐµÑ€ÐµÐ²ÑŒÑ ÑˆÐµÐ¿Ñ‡ÑƒÑ‚ ÑÐºÐ°Ð·ÐºÐ¸, Ð° Ñ€ÐµÐºÐ¸ Ð¿Ð¾ÑŽÑ‚ ÐºÐ¾Ð»Ñ‹Ð±ÐµÐ»ÑŒÐ½Ñ‹Ðµ, Ð¶Ð¸Ð»Ð° Ð±Ð¾Ð»ÑŒÑˆÐ°Ñ Ð¸ Ð´Ñ€ÑƒÐ¶Ð½Ð°Ñ ÑÐµÐ¼ÑŒÑ Ð±Ð°Ð±Ð°ÐºÐ¾Ð² â€” Ð‘Ð°Ð±Ð°ÐºÐµÐ²Ð¸Ñ‡Ð¸. Ð˜Ñ… Ð½Ð¾Ñ€ÐºÐ° Ð±Ñ‹Ð»Ð° ÑÐ°Ð¼Ð¾Ð¹ ÑƒÑŽÑ‚Ð½Ð¾Ð¹ Ð²Ð¾ Ð²ÑÐµÐ¼ Ð»ÐµÑÑƒ: ðŸ¡ ÑÑ‚ÐµÐ½Ñ‹ ÑƒÐºÑ€Ð°ÑˆÐµÐ½Ñ‹ Ð¼Ñ…Ð¾Ð¼, Ð½Ð° Ð¿Ð¾Ð»ÐºÐ°Ñ… ÑÑ‚Ð¾ÑÐ»Ð¸ Ð±Ð°Ð½Ð¾Ñ‡ÐºÐ¸ Ñ Ð¼ÐµÐ´Ð¾Ð¼ ðŸ¯ Ð¸ ÑÐ³Ð¾Ð´Ð°Ð¼Ð¸ ðŸ“, Ð° Ñƒ Ð¾Ñ‡Ð°Ð³Ð° Ð²ÑÐµÐ³Ð´Ð° Ð¿Ð¾Ñ‚Ñ€ÐµÑÐºÐ¸Ð²Ð°Ð»Ð¸ Ð´Ñ€Ð¾Ð²Ð°, Ð½Ð°Ð¿Ð¾Ð»Ð½ÑÑ Ð´Ð¾Ð¼ Ñ‚ÐµÐ¿Ð»Ñ‹Ð¼ ÑÐ²ÐµÑ‚Ð¾Ð¼. ðŸ¿ Ð£ Ð‘Ð°Ð±Ð°ÐºÐµÐ²Ð¸Ñ‡ÐµÐ¹ Ð´Ð¾Ð»Ð³Ð¾ Ð½Ðµ Ð±Ñ‹Ð»Ð¾ Ð´ÐµÑ‚ÐµÐ¹. ÐÐ¾ Ð´Ñ€ÐµÐ²Ð½ÑÑ Ð»ÐµÐ³ÐµÐ½Ð´Ð°, Ñ…Ñ€Ð°Ð½ÑÑ‰Ð°ÑÑÑ Ð² ÑÑ‚Ð°Ñ€Ð¾Ð¼ Ð´ÑƒÐ¿Ð»Ðµ Ð”Ñ€ÐµÐ²Ð° ÐœÑƒÐ´Ñ€Ð¾ÑÑ‚Ð¸ ðŸŒ¿ðŸ“œ, Ð³Ð»Ð°ÑÐ¸Ð»Ð°: Ð¾Ð´Ð½Ð°Ð¶Ð´Ñ‹ Ð² ÑÐµÐ¼ÑŒÐµ Ð±Ð°Ð±Ð°ÐºÐ¾Ð² Ñ€Ð¾Ð´Ð¸Ñ‚ÑÑ Ð´ÐµÐ²Ð¾Ñ‡ÐºÐ° Ñ Ð³Ð»Ð°Ð·Ð°Ð¼Ð¸ Ñ†Ð²ÐµÑ‚Ð° Ð»ÐµÑÐ½Ð¾Ð¹ Ð·ÐµÐ»ÐµÐ½Ð¸ ðŸ€ â€” Ð¸ ÑÑ‚Ð¾ Ð±ÑƒÐ´ÐµÑ‚ Ð½Ð°ÑÑ‚Ð¾ÑÑ‰ÐµÐµ Ñ‡ÑƒÐ´Ð¾. ÐžÐ½Ð° Ð¿Ñ€Ð¸Ð½ÐµÑÐµÑ‚ Ð² Ð¼Ð¸Ñ€ ÑÐ²ÐµÑ‚, Ð´Ð¾Ð±Ñ€Ð¾ Ð¸ Ð³Ð°Ñ€Ð¼Ð¾Ð½Ð¸ÑŽ ðŸ’–, Ð° ÐµÑ‘ ÑÐµÑ€Ð´Ñ†Ðµ Ð±ÑƒÐ´ÐµÑ‚ ÑÑ‚Ð¾Ð»ÑŒ Ñ‡Ð¸ÑÑ‚Ñ‹Ð¼, Ñ‡Ñ‚Ð¾ ÑÐ°Ð¼Ð¾ ÑÐ¾Ð»Ð½Ñ†Ðµ â˜€ï¸ Ð·Ð°Ñ…Ð¾Ñ‡ÐµÑ‚ ÑÐ¾Ð³Ñ€ÐµÐ²Ð°Ñ‚ÑŒ ÐµÑ‘ Ð¿ÑƒÑ‚ÑŒ. ðŸŒ¼ Ð˜ Ð²Ð¾Ñ‚ Ð² Ð¾Ð´Ð¸Ð½ Ð²ÐµÑÐµÐ½Ð½Ð¸Ð¹ Ð´ÐµÐ½ÐµÐº Ð² ÑÐµÐ¼ÑŒÐµ Ð‘Ð°Ð±Ð°ÐºÐµÐ²Ð¸Ñ‡ÐµÐ¹ ÑÐ»ÑƒÑ‡Ð¸Ð»Ð¾ÑÑŒ Ð²ÐµÐ»Ð¸ÐºÐ¾Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ â€” Ñ€Ð¾Ð´Ð¸Ð»Ð°ÑÑŒ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ°Ñ Ð±Ð°Ð±Ð°Ñ‡ÐµÐ½ÐºÐ°, ÐºÐ¾Ñ‚Ð¾Ñ€ÑƒÑŽ Ð½Ð°Ð·Ð²Ð°Ð»Ð¸ Ð‘Ð°Ð±Ð°Ñ‡ÐµÐ½ÑƒÑˆÐºÐ¾Ð¹. Ð’ÑÐµ Ð»ÐµÑÐ½Ñ‹Ðµ Ð·Ð²ÐµÑ€Ð¸ Ð¿Ñ€Ð¸ÑˆÐ»Ð¸ Ð¿Ð¾Ð·Ð´Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ Ñ€Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÐµÐ¹ ðŸ¦ŠðŸ¦‰ðŸ°, Ð¸ Ð´Ð°Ð¶Ðµ ÑÐ°Ð¼Ð° Ð›ÐµÑÐ½Ð°Ñ Ð¤ÐµÑ Ð¿Ð¾ÑÐ»Ð°Ð»Ð° Ð»ÑƒÑ‡Ð¸Ðº ÑÐ¾Ð»Ð½Ñ†Ð°, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑÐ¾Ð³Ñ€ÐµÑ‚ÑŒ ÐºÑ€Ð¾ÑˆÐµÑ‡Ð½ÑƒÑŽ Ð»Ð°Ð¿ÐºÑƒ Ð½Ð¾Ð²Ð¾Ñ€Ð¾Ð¶Ð´ÐµÐ½Ð½Ð¾Ð¹. ðŸƒ ÐšÐ¾Ð³Ð´Ð° Ð‘Ð°Ð±Ð°Ñ‡ÐµÐ½ÑƒÑˆÐºÐ° Ñ€Ð¾Ð´Ð¸Ð»Ð°ÑÑŒ Ð¸ Ð¾Ñ‚ÐºÑ€Ñ‹Ð»Ð° ÑÐ²Ð¾Ð¸ ÑÑ€ÐºÐ¸Ðµ, Ð¸Ð·ÑƒÐ¼Ñ€ÑƒÐ´Ð½Ñ‹Ðµ Ð³Ð»Ð°Ð·ÐºÐ¸, ÑÑ‚Ð°Ð»Ð¾ ÑÑÐ½Ð¾ â€” Ð¿Ñ€Ð¾Ñ€Ð¾Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑÐ±Ñ‹Ð»Ð¾ÑÑŒ. Ð§Ñ‚Ð¾Ð±Ñ‹ ÑƒÐºÑ€ÐµÐ¿Ð¸Ñ‚ÑŒ Ð² Ð½ÐµÐ¹ Ð²ÑÐµ Ð·Ð°Ð»Ð¾Ð¶ÐµÐ½Ð½Ñ‹Ðµ Ð¿Ñ€Ð¸Ñ€Ð¾Ð´Ð¾Ð¹ Ð´Ð°Ñ€Ñ‹, ÐµÑ‘ Ð½ÑƒÐ¶Ð½Ð¾ Ð±Ñ‹Ð»Ð¾ Ð¸ÑÐºÑƒÐ¿Ð°Ñ‚ÑŒ Ð² Ð²Ð¾Ð»ÑˆÐµÐ±Ð½Ð¾Ð¹ Ð²Ð°Ð½Ð½Ð¾Ñ‡ÐºÐµ. ðŸ› ÐžÑ‚ÐµÑ† ÑÐµÐ¼ÐµÐ¹ÑÑ‚Ð²Ð°, Ð‘Ð°Ð±Ð°Ðº Ð›ÐµÑÐ¾Ð²Ð¸Ñ‡, Ð¿Ñ€Ð¸Ð³Ð¾Ñ‚Ð¾Ð²Ð¸Ð» Ð´ÑƒÐ±Ð¾Ð²ÑƒÑŽ ÐºÑƒÐ¿ÐµÐ»ÑŒ ðŸŒ³ Ð¸ Ð½Ð°Ð¿Ð¾Ð»Ð½Ð¸Ð» ÐµÑ‘ Ð¿Ñ€Ð¾Ð·Ñ€Ð°Ñ‡Ð½Ð¾Ð¹ Ð²Ð¾Ð´Ð¾Ð¹ Ð¸Ð· Ñ€ÑƒÑ‡ÑŒÑ. Ð›ÐµÑÐ½Ð°Ñ Ð¤ÐµÑ Ð´Ð¾Ð±Ð°Ð²Ð¸Ð»Ð° Ð² Ð²Ð¾Ð´Ñƒ Ð¾ÑÐ¾Ð±Ñ‹Ðµ Ð¸Ð½Ð³Ñ€ÐµÐ´Ð¸ÐµÐ½Ñ‚Ñ‹: ðŸŒ¿ Ð”Ð¾Ð±Ñ€Ð¾Ñ‚Ñƒ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð‘Ð°Ð±Ð°Ñ‡ÐµÐ½ÑƒÑˆÐºÐ° Ð²ÑÐµÐ³Ð´Ð° Ð¿Ð¾Ð¼Ð¾Ð³Ð°Ð»Ð° Ð´Ñ€ÑƒÐ³Ð¸Ð¼. ðŸŒŸ ÐšÑ€Ð°ÑÐ¾Ñ‚Ñƒ, Ñ‡Ñ‚Ð¾Ð±Ñ‹, Ð³Ð»ÑÐ´Ñ Ð½Ð° Ð½ÐµÑ‘, Ð½ÐµÐ²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ Ð±Ñ‹Ð»Ð¾ Ð¾Ñ‚Ð²ÐµÑÑ‚Ð¸ Ð³Ð»Ð°Ð·. ðŸ¦‰ ÐœÑƒÐ´Ñ€Ð¾ÑÑ‚ÑŒ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¾Ð½Ð° Ð½Ð°Ñ…Ð¾Ð´Ð¸Ð»Ð° Ð²ÐµÑ€Ð½Ñ‹Ðµ Ñ€ÐµÑˆÐµÐ½Ð¸Ñ. ðŸ“ Ð˜Ð·Ñ‹ÑÐºÐ°Ð½Ð½Ð¾ÑÑ‚ÑŒ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÐµÑ‘ Ñ€ÐµÑ‡ÑŒ Ð¸ Ð¿Ð¾ÑÑ‚ÑƒÐ¿ÐºÐ¸ Ð±Ñ‹Ð»Ð¸ Ð¼ÑÐ³ÐºÐ¸Ð¼Ð¸, ÐºÐ°Ðº Ð»ÐµÐ¿ÐµÑÑ‚ÐºÐ¸ Ñ†Ð²ÐµÑ‚Ð¾Ð². ðŸŽ¶ Ð’ÐµÑÐµÐ»Ð¾ÑÑ‚ÑŒ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÐµÑ‘ ÑÐ¼ÐµÑ… Ð·Ð²ÐµÐ½ÐµÐ», ÑÐ»Ð¾Ð²Ð½Ð¾ ÐºÐ°Ð¿ÐµÐ»ÑŒ Ð²ÐµÑÐ½Ð¾Ð¹. ðŸŒ² Ð¡Ñ‚Ð¾Ð¹ÐºÐ¾ÑÑ‚ÑŒ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ð¸ÐºÐ°ÐºÐ¸Ðµ Ð±ÑƒÑ€Ð¸ Ð½Ðµ ÑÐ»Ð¾Ð¼Ð¸Ð»Ð¸ ÐµÑ‘ Ð´ÑƒÑ…. ðŸ«– Ð£ÑŽÑ‚, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ñ€ÑÐ´Ð¾Ð¼ Ñ Ð½ÐµÐ¹ Ð²ÑÐµÐ¼ Ð±Ñ‹Ð»Ð¾ Ñ‚ÐµÐ¿Ð»Ð¾ Ð¸ ÑÐ¿Ð¾ÐºÐ¾Ð¹Ð½Ð¾. ðŸ’– Ð›ÑŽÐ±Ð¾Ð²ÑŒ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÐµÑ‘ ÑÐµÑ€Ð´Ñ†Ðµ Ð²ÑÐµÐ³Ð´Ð° Ð¾ÑÑ‚Ð°Ð²Ð°Ð»Ð¾ÑÑŒ Ð½ÐµÐ¶Ð½Ñ‹Ð¼ Ð¸ ÑÐ²ÐµÑ‚Ð»Ñ‹Ð¼. âœ¨ ÐšÐ°Ðº Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð‘Ð°Ð±Ð°Ñ‡ÐµÐ½ÑƒÑˆÐºÑƒ Ð¾Ð¿ÑƒÑÑ‚Ð¸Ð»Ð¸ Ð² Ð²Ð¾Ð»ÑˆÐµÐ±Ð½ÑƒÑŽ Ð²Ð°Ð½Ð½Ð¾Ñ‡ÐºÑƒ, Ð²Ð¾Ð´Ð° Ð·Ð°Ð¸ÑÐºÑ€Ð¸Ð»Ð°ÑÑŒ, Ð° Ð°Ñ€Ð¾Ð¼Ð°Ñ‚ Ñ‚Ñ€Ð°Ð² Ð½Ð°Ð¿Ð¾Ð»Ð½Ð¸Ð» Ð²ÑÑŽ Ð½Ð¾Ñ€ÐºÑƒ. ÐœÐ°Ð»ÐµÐ½ÑŒÐºÐ°Ñ Ð‘Ð°Ð±Ð°Ñ‡ÐµÐ½ÑƒÑˆÐºÐ° Ð·Ð°ÑƒÐ»Ñ‹Ð±Ð°Ð»Ð°ÑÑŒ, Ð¸ Ñ‚ÑƒÑ‚ Ð¶Ðµ Ð»ÐµÑ Ð½Ð°Ð¿Ð¾Ð»Ð½Ð¸Ð»ÑÑ Ñ‚ÐµÐ¿Ð»Ð¾Ð¼, Ð° Ñ†Ð²ÐµÑ‚Ñ‹ Ñ€Ð°ÑÐ¿ÑƒÑÑ‚Ð¸Ð»Ð¸ÑÑŒ! ðŸŒ¸ ðŸ“† Ð¨Ð»Ð¸ Ð³Ð¾Ð´Ñ‹, Ð‘Ð°Ð±Ð°Ñ‡ÐµÐ½ÑƒÑˆÐºÐ° Ñ€Ð¾ÑÐ»Ð°, Ð¸ Ð²ÑÐµ Ð·Ð°Ð¼ÐµÑ‡Ð°Ð»Ð¸, ÐºÐ°ÐºÐ¾Ð¹ Ñ‡ÑƒÐ´ÐµÑÐ½Ð¾Ð¹ Ð¾Ð½Ð° ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ð»Ð°ÑÑŒ. ÐžÐ½Ð° ÑƒÐ¼ÐµÐ»Ð° ÑÐ»ÑƒÑˆÐ°Ñ‚ÑŒ Ð¸ ÑƒÑ‚ÐµÑˆÐ°Ñ‚ÑŒ, Ð·Ð½Ð°Ð»Ð° Ð²ÑÐµ Ñ‚Ð°Ð¹Ð½Ñ‹Ðµ Ñ‚Ñ€Ð¾Ð¿Ð¸Ð½ÐºÐ¸ Ð»ÐµÑÐ° ðŸŒ¿, Ð° ÐµÑ‘ ÑÐ¼ÐµÑ… Ð´ÐµÐ»Ð°Ð» Ð´Ð°Ð¶Ðµ Ñ…Ð¼ÑƒÑ€Ñ‹Ðµ Ð´Ð½Ð¸ ÑÐ¾Ð»Ð½ÐµÑ‡Ð½Ñ‹Ð¼Ð¸. ðŸ¡ ÐžÐ´Ð½Ð°Ð¶Ð´Ñ‹ ÑÐ»ÑƒÑ‡Ð¸Ð»Ð°ÑÑŒ Ð±ÐµÐ´Ð°: Ð·Ð»Ð¾Ð¹ Ð²ÐµÑ‚ÐµÑ€ ÑƒÐ½ÐµÑ Ñƒ Ñ‘Ð¶Ð¸ÐºÐ° ÐšÐ¾Ð»ÑŽÑ‡ÐºÐ¸ ÐµÐ³Ð¾ Ð´Ð¾Ð¼Ð¸Ðº Ð¸Ð· Ð»Ð¸ÑÑ‚ÑŒÐµÐ² ðŸ‚. Ð‘Ð°Ð±Ð°Ñ‡ÐµÐ½ÑƒÑˆÐºÐ°, Ð½Ðµ Ñ€Ð°Ð·Ð´ÑƒÐ¼Ñ‹Ð²Ð°Ñ, ÑÐ¾Ð±Ñ€Ð°Ð»Ð° Ð²ÑÐµÑ… Ð»ÐµÑÐ½Ñ‹Ñ… Ð´Ñ€ÑƒÐ·ÐµÐ¹ ðŸ»ðŸ­ðŸ¦”, Ð¸ Ð´Ñ€ÑƒÐ¶Ð½Ð¾Ð¹ ÐºÐ¾Ð¼Ð¿Ð°Ð½Ð¸ÐµÐ¹ Ð¾Ð½Ð¸ Ð¿Ð¾ÑÑ‚Ñ€Ð¾Ð¸Ð»Ð¸ ÐµÐ¶Ð¸ÐºÑƒ Ð½Ð¾Ð²Ñ‹Ð¹ Ð´Ð¾Ð¼ â€” ÐµÑ‰Ñ‘ ÐºÑ€ÐµÐ¿Ñ‡Ðµ Ð¸ ÑƒÑŽÑ‚Ð½ÐµÐµ. Ð¡ Ñ‚ÐµÑ… Ð¿Ð¾Ñ€ Ð‘Ð°Ð±Ð°Ñ‡ÐµÐ½ÑƒÑˆÐºÑƒ ÑÑ‚Ð°Ð»Ð¸ Ð·Ð²Ð°Ñ‚ÑŒ Ð›ÐµÑÐ½Ñ‹Ð¼ Ð¡Ð¾Ð»Ð½Ñ‹ÑˆÐºÐ¾Ð¼ â˜€ï¸, Ð¿Ð¾Ñ‚Ð¾Ð¼Ñƒ Ñ‡Ñ‚Ð¾ Ð¾Ð½Ð° ÑÐ¾Ð³Ñ€ÐµÐ²Ð°Ð»Ð° Ð²ÑÐµÑ… Ð²Ð¾ÐºÑ€ÑƒÐ³. â³ Ð“Ð¾Ð´Ñ‹ ÑˆÐ»Ð¸, Ð¸ Ð‘Ð°Ð±Ð°Ñ‡ÐµÐ½ÑƒÑˆÐºÐ° Ñ€Ð¾ÑÐ»Ð°. ÐžÐ½Ð° ÑÑ‚Ð°Ð»Ð° Ð³Ñ€Ð°Ñ†Ð¸Ð¾Ð·Ð½Ð¾Ð¹, Ð¼ÑƒÐ´Ñ€Ð¾Ð¹ Ð¸ ÐµÑ‰Ñ‘ Ð±Ð¾Ð»ÐµÐµ Ð´Ð¾Ð±Ñ€Ð¾Ð¹ Ð±Ð°Ð±Ð°Ñ‡ÐµÐ½ÐºÐ¾Ð¹. Ð’ÑÑÐºÐ¸Ð¹, ÐºÑ‚Ð¾ Ð²ÑÑ‚Ñ€ÐµÑ‡Ð°Ð» ÐµÑ‘, ÑƒÐ»Ñ‹Ð±Ð°Ð»ÑÑ, Ð¿Ð¾Ñ‚Ð¾Ð¼Ñƒ Ñ‡Ñ‚Ð¾ Ð¾Ñ‚ Ð½ÐµÑ‘ Ð¸ÑÑ…Ð¾Ð´Ð¸Ð»Ð¾ Ð¾ÑÐ¾Ð±Ð¾Ðµ Ñ‚ÐµÐ¿Ð»Ð¾. ðŸš¶â€â™€ï¸ ÐÐ¾ Ð²Ð¾Ñ‚ Ð½Ð°ÑÑ‚Ð°Ð» Ð´ÐµÐ½ÑŒ, ÐºÐ¾Ð³Ð´Ð° Ð‘Ð°Ð±Ð°Ñ‡ÐµÐ½ÑƒÑˆÐºÐµ Ð½ÑƒÐ¶Ð½Ð¾ Ð±Ñ‹Ð»Ð¾ Ð¿Ð¾ÐºÐ¸Ð½ÑƒÑ‚ÑŒ Ñ€Ð¾Ð´Ð½ÑƒÑŽ Ð½Ð¾Ñ€ÐºÑƒ. Ð¡ÐµÑ€Ð´Ñ†Ðµ Ð¿Ð¾Ð´ÑÐºÐ°Ð·Ñ‹Ð²Ð°Ð»Ð¾ ÐµÐ¹, Ñ‡Ñ‚Ð¾ Ð² Ð±Ð¾Ð»ÑŒÑˆÐ¾Ð¼ Ð¼Ð¸Ñ€Ðµ ÐµÑÑ‚ÑŒ Ñ‚Ðµ, ÐºÑ‚Ð¾ Ð½ÑƒÐ¶Ð´Ð°ÐµÑ‚ÑÑ Ð² ÐµÑ‘ Ð¿Ð¾Ð¼Ð¾Ñ‰Ð¸. â€” ÐœÑ‹ Ð²ÑÐµÐ³Ð´Ð° Ð±ÑƒÐ´ÐµÐ¼ Ð¶Ð´Ð°Ñ‚ÑŒ Ñ‚ÐµÐ±Ñ, Ð¼Ð¸Ð»Ð°Ñ! â€” ÐºÑ€Ð¸Ñ‡Ð°Ð»Ð¸ ÐµÐ¹ Ð·Ð²ÐµÑ€ÑƒÑˆÐºÐ¸, Ð¿Ð¾Ð´Ð°Ð²Ð°Ñ ÑƒÐ·ÐµÐ»Ð¾Ðº Ñ Ð¾Ñ€ÐµÑˆÐºÐ°Ð¼Ð¸ Ð¸ ÑÑƒÑˆÐµÐ½Ñ‹Ð¼Ð¸ ÑÐ³Ð¾Ð´Ð°Ð¼Ð¸. ðŸŒ°ðŸ‡ ðŸ’« Ð‘Ð°Ð±Ð°Ñ‡ÐµÐ½ÑƒÑˆÐºÐ° Ð¿Ñ€Ð¾ÑÑ‚Ð¸Ð»Ð°ÑÑŒ Ñ ÑÐµÐ¼ÑŒÑ‘Ð¹ Ð¸ Ð´Ñ€ÑƒÐ·ÑŒÑÐ¼Ð¸ Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð°ÑÑŒ Ð² Ð¿ÑƒÑ‚ÑŒ. ðŸž Ð¡ Ñ‚ÐµÑ… Ð¿Ð¾Ñ€ Ð² Ð»ÐµÑÑƒ Ð¾ Ð½ÐµÐ¹ Ñ…Ð¾Ð´Ð¸Ð»Ð¸ Ð»ÐµÐ³ÐµÐ½Ð´Ñ‹. Ð›ÐµÑÐ½Ñ‹Ðµ Ð·Ð²ÐµÑ€Ð¸ Ð¿ÐµÑ€ÐµÐ´Ð°Ð²Ð°Ð»Ð¸ Ð´Ñ€ÑƒÐ³ Ð´Ñ€ÑƒÐ³Ñƒ Ð²ÐµÑÑ‚Ð¸ Ð¾ ÐµÑ‘ Ð²ÐµÐ»Ð¸ÐºÐ¸Ñ… Ð´Ð¾Ð±Ñ€Ñ‹Ñ… Ð´ÐµÐ»Ð°Ñ…: ðŸ§¸ â€œÐ“Ð¾Ð²Ð¾Ñ€ÑÑ‚, Ñ‡Ñ‚Ð¾ Ð‘Ð°Ð±Ð°Ñ‡ÐµÐ½ÑƒÑˆÐºÐ° Ð¿Ð¾Ð¼Ð¾Ð³Ð»Ð° Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¾Ð¼Ñƒ Ð¼ÐµÐ´Ð²ÐµÐ¶Ð¾Ð½ÐºÑƒ Ð½Ð°Ð¹Ñ‚Ð¸ Ð´Ð¾Ñ€Ð¾Ð³Ñƒ Ð´Ð¾Ð¼Ð¾Ð¹, ÐºÐ¾Ð³Ð´Ð° Ð¾Ð½ Ð·Ð°Ð±Ð»ÑƒÐ´Ð¸Ð»ÑÑ Ð² Ð³Ð¾Ñ€Ð°Ñ…!â€ ðŸ‡ â€œÐ Ñ ÑÐ»Ñ‹ÑˆÐ°Ð»Ð°, Ñ‡Ñ‚Ð¾ Ð¾Ð½Ð° Ð½Ð°ÑƒÑ‡Ð¸Ð»Ð° Ð¿ÑƒÐ³Ð»Ð¸Ð²Ð¾Ð³Ð¾ Ð·Ð°Ð¹Ñ‡Ð¾Ð½ÐºÐ° Ð±Ñ‹Ñ‚ÑŒ ÑÐ¼ÐµÐ»Ñ‹Ð¼ Ð¸ Ð¾Ñ‚Ð²Ð°Ð¶Ð½Ñ‹Ð¼!â€ ðŸ’¦ â€œÐ ÐµÑ‰Ñ‘ Ð¾Ð½Ð° ÑÐ¿Ð°ÑÐ»Ð° Ð¿Ñ€ÑƒÐ´ Ð¾Ñ‚ Ð·Ð°ÑÑƒÑ…Ð¸, Ñ€Ð°Ð·Ñ‹ÑÐºÐ°Ð² Ð²Ð¾Ð»ÑˆÐµÐ±Ð½Ñ‹Ð¹ Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸Ðº Ð²Ð¾Ð´Ñ‹!â€ ðŸ¦‰ Ð’ÑÑÐºÐ¸Ð¹ Ñ€Ð°Ð·, ÐºÐ¾Ð³Ð´Ð° Ð² Ð»ÐµÑÑƒ ÐºÑ‚Ð¾-Ñ‚Ð¾ Ð¿Ð¾Ð¿Ð°Ð´Ð°Ð» Ð² Ð±ÐµÐ´Ñƒ, ÑÑ‚Ð°Ñ€Ñ‹Ð¹ Ñ„Ð¸Ð»Ð¸Ð½ ÐšÐ½Ð¸Ð³Ð¾Ð²ÐµÐ´ Ð³Ð¾Ð²Ð¾Ñ€Ð¸Ð»: â€” ÐÐµ Ð¿ÐµÑ‡Ð°Ð»ÑŒÑ‚ÐµÑÑŒ, Ð´Ñ€ÑƒÐ·ÑŒÑ. Ð“Ð´Ðµ Ð±Ñ‹ Ð½Ð¸ Ð±Ñ‹Ð»Ð° Ð‘Ð°Ð±Ð°Ñ‡ÐµÐ½ÑƒÑˆÐºÐ°, Ð¾Ð½Ð° Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð½Ð°Ð¹Ð´Ñ‘Ñ‚ ÑÐ¿Ð¾ÑÐ¾Ð± Ð¿Ð¾Ð¼Ð¾Ñ‡ÑŒ. Ð”Ð¾Ð±Ñ€Ð¾, ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ðµ Ð¼Ñ‹ Ð´Ð°Ñ€Ð¸Ð¼ Ð¼Ð¸Ñ€Ñƒ, Ð²ÑÐµÐ³Ð´Ð° Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ÑÑ! ðŸŒ… Ð˜ ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð²ÐµÑ‡ÐµÑ€, ÐºÐ¾Ð³Ð´Ð° ÑÐ¾Ð»Ð½Ñ†Ðµ ÑÐ°Ð´Ð¸Ð»Ð¾ÑÑŒ Ð·Ð° Ñ…Ð¾Ð»Ð¼Ñ‹, ÐµÐ³Ð¾ Ð¼ÑÐ³ÐºÐ¸Ðµ Ð»ÑƒÑ‡Ð¸ Ð»Ð¾Ð¶Ð¸Ð»Ð¸ÑÑŒ Ð½Ð° Ð»ÐµÑ Ñ‚Ð°Ðº Ð±ÐµÑ€ÐµÐ¶Ð½Ð¾, Ð±ÑƒÐ´Ñ‚Ð¾ ÑÐ°Ð¼Ð° Ð‘Ð°Ð±Ð°Ñ‡ÐµÐ½ÑƒÑˆÐºÐ° Ð¿Ñ€Ð¸ÑÑ‹Ð»Ð°Ð»Ð° ÑÐ²Ð¾Ð¹ Ñ‚Ñ‘Ð¿Ð»Ñ‹Ð¹ Ð¿Ñ€Ð¸Ð²ÐµÑ‚ Ñ€Ð¾Ð´Ð½Ð¾Ð¼Ñƒ Ð´Ð¾Ð¼Ñƒ. ðŸ¿ Ð¯ Ð²Ñ‹Ñ€Ð¾Ñ Ð½Ð° Ñ€Ð°ÑÑÐºÐ°Ð·Ð°Ñ… Ð¾ Ñ‚ÐµÐ±Ðµ, â€” Ð²Ð´Ñ€ÑƒÐ³ ÑÐºÐ°Ð·Ð°Ð» Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¸Ð¹ Ð±Ð°Ð±Ð°Ñ‡Ð¾Ðº Ð¨ÑƒÑÑ‚Ñ€Ð¸Ðº, ÑÑ‚Ð¾Ñ Ð¿ÐµÑ€ÐµÐ´ Ð‘Ð°Ð±Ð°Ñ‡ÐµÐ½ÑƒÑˆÐºÐ¾Ð¹. â€” Ð’ÑÐµ Ð² Ð½Ð°ÑˆÐµÐ¼ Ð»ÐµÑÑƒ Ð¿Ð¾Ð¼Ð½ÑÑ‚ Ð›ÐµÑÐ½Ð¾Ðµ Ð¡Ð¾Ð»Ð½Ñ‹ÑˆÐºÐ¾, Ñ‡Ñ‚Ð¾ ÑƒÑˆÐ»Ð¾ Ð² Ð´Ð°Ð»ÑŒÐ½Ð¸Ðµ ÐºÑ€Ð°Ñ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½ÐµÑÑ‚Ð¸ Ð´Ð¾Ð±Ñ€Ð¾. ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ð²ÐµÑ‡ÐµÑ€, ÐºÐ¾Ð³Ð´Ð° ÑÐ¾Ð»Ð½Ñ†Ðµ ÑÐ°Ð´Ð¸Ð»Ð¾ÑÑŒ Ð·Ð° Ñ…Ð¾Ð»Ð¼Ñ‹, ÐµÐ³Ð¾ Ð¼ÑÐ³ÐºÐ¸Ðµ Ð»ÑƒÑ‡Ð¸ Ð»Ð¾Ð¶Ð¸Ð»Ð¸ÑÑŒ Ð½Ð° Ð½Ð°Ñˆ Ð»ÐµÑ, Ð¸ Ð²ÑÐµ Ð²ÐµÑ€Ð¸Ð»Ð¸ â€” Ñ‚Ñ‹ Ð¾ Ð½Ð°Ñ Ð¿Ð¾Ð¼Ð½Ð¸ÑˆÑŒ. ÐÐ¾ Ð¼Ð½Ðµ Ð±Ñ‹Ð»Ð¾ Ð¼Ð°Ð»Ð¾ Ð¾Ð´Ð½Ð¸Ñ… Ñ€Ð°ÑÑÐºÐ°Ð·Ð¾Ð² Ð¸ ÑÐ¾Ð»Ð½ÐµÑ‡Ð½Ñ‹Ñ… Ð»ÑƒÑ‡ÐµÐ¹. Ð¯ Ñ…Ð¾Ñ‚ÐµÐ» Ð½Ð°Ð¹Ñ‚Ð¸ Ñ‚ÐµÐ±Ñ. Ð¥Ð¾Ñ‚ÐµÐ» ÑƒÐ²Ð¸Ð´ÐµÑ‚ÑŒ ÑÐ²Ð¾Ð¸Ð¼Ð¸ Ð³Ð»Ð°Ð·Ð°Ð¼Ð¸ Ñ‚Ñƒ, Ð¾ ÐºÐ¾Ð¼ Ð³Ð¾Ð²Ð¾Ñ€ÑÑ‚ Ñ Ñ‚Ð°ÐºÐ¸Ð¼ Ð²Ð¾ÑÑ…Ð¸Ñ‰ÐµÐ½Ð¸ÐµÐ¼. Ð¯ Ð¿ÐµÑ€ÐµÑÐµÐº Ñ‡Ð°Ñ‰Ð¸ ðŸŒ², Ð±Ñ€Ð¾Ð´Ð¸Ð» Ð¿Ð¾ Ñ‚ÑƒÐ¼Ð°Ð½Ð½Ñ‹Ð¼ Ð»ÑƒÐ³Ð°Ð¼ ðŸŒ¾, Ð¿Ñ€Ð¾Ð±Ð¸Ñ€Ð°Ð»ÑÑ Ñ‡ÐµÑ€ÐµÐ· Ð½ÐµÐ·Ð½Ð°ÐºÐ¾Ð¼Ñ‹Ðµ Ð»ÐµÑÐ°, Ð¿Ð¾Ð´Ð½Ð¸Ð¼Ð°Ð»ÑÑ Ð² Ð³Ð¾Ñ€Ñ‹ ðŸ”, Ð³Ð´Ðµ ÑÐ½ÐµÐ³ Ð±ÐµÐ»ÐµÐµ Ð¼Ð¾Ð»Ð¾ÐºÐ°. Ð¯ ÑÐ¿Ñ€Ð°ÑˆÐ¸Ð²Ð°Ð» Ñƒ ÑÐ¾Ð², Ñƒ Ð±Ñ‹ÑÑ‚Ñ€Ñ‹Ñ… Ñ€ÑƒÑ‡ÑŒÐµÐ², Ñƒ Ð·Ð²ÐµÐ·Ð´ âœ¨â€” Ð¸ Ð²ÑÐµ Ð³Ð¾Ð²Ð¾Ñ€Ð¸Ð»Ð¸ Ð¾Ð´Ð½Ð¾: â€œÐ‘Ð°Ð±Ð°Ñ‡ÐµÐ½ÑƒÑˆÐºÑƒ Ñ‚Ð°Ð¼, Ð³Ð´Ðµ Ð´Ð¾Ð±Ñ€Ð¾ Ð¸ ÑÐ²ÐµÑ‚.â€ â€” Ð˜ Ð²Ð¾Ñ‚ Ñ Ð·Ð´ÐµÑÑŒ. Ð¯ Ð½Ð°ÑˆÑ‘Ð» Ñ‚ÐµÐ±Ñ. Ð˜ ÑÑ‡Ð°ÑÑ‚Ð»Ð¸Ð². ðŸ’–"
                    const image = images[Math.floor(Math.random() * images.length)];
                    await bot.telegram.sendPhoto(task.chatId, image);
                    await bot.telegram.sendMessage(task.chatId, currentMessage);

                    task.messageIndex = (task.messageIndex + 1) % messages.length;
                    await task.save();
                },
                null,
                true,
                "America/Anchorage"
            );

            task.job = newJob;
            await task.save();
        }
    });
}

mongoose
    .connect(process.env.DB_HOST)
    .then(() => {
        console.log("Connected to database!");

        updateCronJobs();
    })
    .catch((err) => {
        console.error("Error connecting to the database:", err);
    });

const bot = new Telegraf(process.env.BOT_TOKEN);
const app = express();

app.use(express.json());

let task;

async function startCronJob(chatId) {
    let existingTask = await CronTask.findOne({ chatId });


    if (!existingTask) {
        existingTask = new CronTask({ chatId, messageIndex: 0 });
        await existingTask.save();
    }


    if (task) {
        task.stop();
        task = null;
    }


    task = new CronJob(
        "30 5 * * *",
        async function () {

            existingTask = await CronTask.findOne({ chatId });

            if (!existingTask) return;

            const currentMessage = messages[existingTask.messageIndex];
            const image = images[Math.floor(Math.random() * images.length)];

            await bot.telegram.sendPhoto(chatId, image);
            await bot.telegram.sendMessage(chatId, currentMessage);

            existingTask.messageIndex = (existingTask.messageIndex + 1) % messages.length;

            if (existingTask) {
                await existingTask.save();
            }
        },
        null,
        true,
        "America/Anchorage"
    );
}

bot.start((ctx) => {
    ctx.reply("ðŸ‘‹ ÐŸÑ€Ð¸Ð²ÐµÑ‚! ÐœÐµÐ½Ñ Ð·Ð¾Ð²ÑƒÑ‚ Ð‘Ð°Ð±Ð°Ñ‡ÐµÐ½Ð¾Ðº, Ñ ÑƒÐ·Ð½Ð°Ð» Ñ‡Ñ‚Ð¾ Ñ‚Ñ‹ Ð¸Ð· ÑÐµÐ¼ÑŒÐ¸ Ð‘Ð°Ð±Ð°ÐºÐµÐ²ÐµÑ‡ÐµÐ¹ Ð¸ Ñ‚ÑƒÑ‚ Ð¶Ðµ Ð¿Ð¾ÑÑ‚Ð°Ñ€Ð°Ð»ÑÑ Ñ‚ÐµÐ±Ñ Ð½Ð°Ð¹Ñ‚Ð¸ Ñ‡Ñ‚Ð¾Ð± ÑÑ‚Ð°Ñ‚ÑŒ Ñ‚Ð²Ð¾Ð¸ Ð´Ñ€ÑƒÐ³Ð¾Ð¼. Ð’ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð¼ Ñ ÑÐ¿Ð»ÑŽ ÐºÐ°Ðº Ð¸ Ð²ÑÐµ Ð¼Ñ‹ Ð±Ð°Ð±Ð°ÐºÐ¸, Ð½Ð¾ Ñ ÑÑ‚Ð¾Ð³Ð¾ Ð´Ð½Ñ Ñ ÑÐ¿ÐµÑ†Ð¸Ð°Ð»ÑŒÐ½Ð¾ Ð±ÑƒÐ´Ñƒ Ð¿Ñ€Ð¾ÑÑ‹Ð¿Ð°Ñ‚ÑŒÑÑ ÐºÐ°Ð¶Ð´Ð¾Ðµ ÑƒÑ‚Ñ€Ð¾ Ñ‡Ñ‚Ð¾Ð± Ñ‚Ð²Ð¾Ðµ ÑƒÑ‚Ñ€Ð¾ Ð±Ñ‹Ð»Ð¾ ÐºÐ°Ðº Ð¼Ð¾Ð¶Ð½Ð¾ Ñ‚ÐµÐ¿Ð»ÐµÐµ Ð¸ Ñ€Ð°Ð´Ð¾ÑÑ‚Ð½ÐµÐµ! ðŸŒž\n âœ¨ Ð•ÑÐ»Ð¸ Ñ…Ð¾Ñ‡ÐµÑˆÑŒ Ð´Ñ€ÑƒÐ¶Ð¸Ñ‚ÑŒ ÑÐ¾ Ð¼Ð½Ð¾Ð¹ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð½Ð°Ð¿Ð¸ÑˆÐ¸ 'Ð”Ð°Ð²Ð°Ð¹ Ð´Ñ€ÑƒÐ¶Ð¸Ñ‚ÑŒ'\n Ð¡ ÑƒÐ²Ð°Ð¶ÐµÐ½Ð¸ÐµÐ¼, Ð‘Ð°Ð±Ð°Ñ‡ÐµÐ½Ð¾Ðº! ðŸ¿");
});

app.post(`/webhook/${process.env.BOT_TOKEN}`, (req, res) => {
    bot.handleUpdate(req.body);
    res.sendStatus(200);
});

bot.on("text", async (ctx) => {
    const message = ctx.message.text.toLowerCase();
    const chatId = ctx.chat.id;

    if (message === "Ð´Ð°Ð²Ð°Ð¹ Ð´Ñ€ÑƒÐ¶Ð¸Ñ‚ÑŒ") {
        ctx.reply("ðŸ¿ Ð£Ñ€Ð°!! ÐœÑ‹ Ñ Ñ‚Ð¾Ð±Ð¾Ð¹ Ð´Ñ€ÑƒÐ·ÑŒÑ! Ð¯ Ñ‚Ð°Ðº Ñ€Ð°Ð´, Ñ‡Ñ‚Ð¾ Ñ‚Ñ‹ Ñ…Ð¾Ñ‡ÐµÑˆÑŒ Ð´Ñ€ÑƒÐ¶Ð¸Ñ‚ÑŒ! Ð¯ Ð¾Ð±ÐµÑ‰Ð°ÑŽ Ð´ÐµÐ»Ð°Ñ‚ÑŒ Ñ‚Ð²Ð¾Ð¸ ÑƒÑ‚Ñ€ÐµÐ½Ð½Ð¸Ðµ Ñ‡Ð°ÑÑ‹ ÑÑ€Ñ‡Ðµ Ð¸ Ð²ÐµÑÐµÐ»ÐµÐµ. ÐšÐ°Ð¶Ð´Ð¾Ðµ ÑƒÑ‚Ñ€Ð¾ Ð±ÑƒÐ´Ñƒ Ð¿Ñ€Ð¾ÑÑ‹Ð¿Ð°Ñ‚ÑŒÑÑ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ Ñ‚Ð¾Ð³Ð¾, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿Ð¾ÑÐ»Ð°Ñ‚ÑŒ Ñ‚ÐµÐ±Ðµ Ð½ÐµÐ¼Ð½Ð¾Ð³Ð¾ Ð¿Ð¾Ð·Ð¸Ñ‚Ð¸Ð²Ð°! ðŸŒž Ð¢Ð°Ðº Ñ‡Ñ‚Ð¾ Ð³Ð¾Ñ‚Ð¾Ð²ÑŒÑÑ, Ñ Ð²ÑÐµÐ³Ð´Ð° Ñ€ÑÐ´Ð¾Ð¼, Ð³Ð¾Ñ‚Ð¾Ð² Ð¿Ð¾Ð´ÐµÐ»Ð¸Ñ‚ÑŒÑÑ Ð´Ð¾Ð±Ñ€Ñ‹Ð¼Ð¸ ÑÐ»Ð¾Ð²Ð°Ð¼Ð¸ Ð¸ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑŒÑŽ! âœ¨");

        const existingUser = await User.findOne({ chatId });
        if (!existingUser) {
            await new User({ chatId }).save();
        }

        startCronJob(chatId);

    } else if (message === "Ñ ÑÐ¾ÑÐºÑƒÑ‡Ð¸Ð»ÑÑ") {
        ctx.reply("ðŸ¿ Ð£Ñ€Ð°!!!! Ð¢Ñ‹ Ð²ÐµÑ€Ð½ÑƒÐ»ÑÑ! Ð¯ Ñ‚Ð°Ðº ÑÐ¾ÑÐºÑƒÑ‡Ð¸Ð»ÑÑ Ð¿Ð¾ Ñ‚ÐµÐ±Ðµ! Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ñ ÑÐ½Ð¾Ð²Ð° Ð³Ð¾Ñ‚Ð¾Ð² Ñ€Ð°Ð´Ð¾Ð²Ð°Ñ‚ÑŒ Ñ‚ÐµÐ±Ñ, Ð¿Ð¾Ð´Ð½Ð¸Ð¼Ð°Ñ‚ÑŒ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ðµ Ð¸ Ð±Ñ‹Ñ‚ÑŒ Ñ€ÑÐ´Ð¾Ð¼! Ð”Ð°Ð²Ð°Ð¹ Ð½Ð°Ñ‡Ð½ÐµÐ¼ Ð½Ð¾Ð²Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ Ñ ÑƒÐ»Ñ‹Ð±ÐºÐ¾Ð¹! ðŸŒž");

        startCronJob(chatId);

    } else if (message === "Ð½Ðµ Ñ…Ð¾Ñ‡Ñƒ Ñ Ñ‚Ð¾Ð±Ð¾Ð¹ Ð´Ñ€ÑƒÐ¶Ð¸Ñ‚ÑŒ") {
        const existingTask = await CronTask.findOne({ chatId });
        if (existingTask) {
            await CronTask.deleteOne({ chatId });
            if (task) {
                task.stop();
                task = null;
            }
            ctx.reply(stopMsgs[Math.floor(Math.random() * stopMsgs.length)]);

        } else {
            ctx.reply("Ð¯ Ð¸ Ñ‚Ð°Ðº Ð¼Ð¾Ð»Ñ‡Ð°Ð»... ðŸ˜…");
        }
    } else {
        const randomExcuse = excuses[Math.floor(Math.random() * excuses.length)];
        bot.telegram.sendMessage(chatId, randomExcuse);
    }
});

const WEBHOOK_URL = `${process.env.SERVER_URL}/webhook/${process.env.BOT_TOKEN}`;
bot.telegram.setWebhook(WEBHOOK_URL).then(() => {
    console.log(`âœ… Webhook ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½: ${WEBHOOK_URL}`);
});


app.get("/", function (req, res) {
    res.send("Hello")
})

const PORT = 7001;
app.listen(PORT, () => {
    console.log(`ðŸš€ Ð¡ÐµÑ€Ð²ÐµÑ€ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½ Ð½Ð° Ð¿Ð¾Ñ€Ñ‚Ñƒ ${PORT}`);
});